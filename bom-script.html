<script src="//cdnjs.cloudflare.com/ajax/libs/money.js/0.2.0/money.min.js" integrity="sha256-kCmDaPrZX+ae0D0EJQylHG7OAtg5kb1KMrYMmLLtHWQ=" crossorigin="anonymous"></script>
<script>
  fx.base = "USD"
  fx.rates = { "SGD": 1.36, "EUR": 0.90, "GBP": 0.82, "RMB": 6.94, "INR": 69.67, "USD": 1 }
  fx.settings = { from: "SGD", to: "USD" }

  var currencySymbols = { "SGD": "$", "EUR": "€", "GBP": "£", "RMB": "¥", "INR": "₹", "USD": "$" }
  var currencyEl = document.getElementById("currency")

  function changeBomCost(currency) {
    var bomCostEls = document.getElementsByClassName("bom-cost")
    var bomCostList = [{% assign boms = site.data.bill_of_materials %} {% for bom in boms %} {{bom.Unit | round:2}}, {% endfor %}]

    for (var i = 0; i < bomCostEls.length; i++) {
      bomCostEls[i].innerText = currencySymbols[currency] + fx.convert(bomCostList[i], {from: "SGD", to: currency}).toFixed(2)
    }
  }

  function changeTotalBomCost(currency) {
    var bomCostEls = document.getElementsByClassName("bom-cost")
    var bomTotalItemsEl = document.getElementsByClassName("bom-quantity")

    var bomCost = 0.0;
    for (var i = 0; i < bomCostEls.length; i++) {
      if (bomCostEls[i].innerText) {
        bomCost += parseFloat(bomCostEls[i].innerText.substr(1) * bomTotalItemsEl[i].innerText)
      }
    }

    document.getElementById("bom-cost").innerHTML = currencySymbols[currency] + bomCost.toFixed(2)
  }

  // On first page load, change all BOM cost to the default USD currency
  changeBomCost("USD")
  changeTotalBomCost("USD")

  // On change in dropdown, change all BOM cost to the chosen currency
  currencyEl.onchange = function() {
    changeBomCost(this.value)
    changeTotalBomCost(this.value)
  }
</script>
