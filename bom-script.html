<script src="//cdnjs.cloudflare.com/ajax/libs/money.js/0.2.0/money.min.js" integrity="sha256-kCmDaPrZX+ae0D0EJQylHG7OAtg5kb1KMrYMmLLtHWQ=" crossorigin="anonymous"></script>
<script>
  fx.base = "USD"
  fx.rates = {
    "SGD": 1.36,
    "EUR": 0.90,
    "GBP": 0.82,
    "RMB": 6.94,
    "INR": 69.67,
    "USD": 1
  }
  fx.settings = { from: "SGD", to: "USD" }

  var currencySymbols = {
    "SGD": "$",
    "EUR": "€",
    "GBP": "£",
    "RMB": "¥",
    "INR": "₹",
    "USD": "$"
  }

  // TODO: Store initial BOM unit cost in SGD with liquid template and then manipulate the currency exchange
  document.getElementById("currency").onchange = function() {
    console.log(this.value)

    var bomCostEls = document.getElementsByClassName("bom-cost")

    for (var i = 0; i < bomCostEls.length; i++) {
      if (bomCostEls[i].innerText) {

        var unitCost = bomCostEls[i].innerText.substr(1)
        bomCostEls[i].innerText = currencySymbols[this.value] + fx.convert(unitCost, {from: "SGD", to: this.value}).toFixed(2)
      }
    }
  }

</script>

<script>
  // Get the total number of unique BOM items
  var bomUniqueItems = document.getElementsByClassName("bom-item").length
  document.getElementById("bom-unique").innerHTML = bomUniqueItems

  // Get the total number of BOM items
  var bomTotalItemsEl = document.getElementsByClassName("bom-quantity")
  var bomTotalItems = 0;
  for (var i = 0; i < bomTotalItemsEl.length; i++) {
    bomTotalItems += parseInt(bomTotalItemsEl[i].innerText, 10)
  }
  document.getElementById("bom-total").innerHTML = bomTotalItems

  // Get the total cost of BOM items
  var bomCostEl = document.getElementsByClassName("bom-cost")
  var bomCost = 0.0;
  for (var i = 0; i < bomCostEl.length; i++) {
    if (bomCostEl[i].innerText) {
      bomCost += parseFloat(bomCostEl[i].innerText.substr(1) * bomTotalItemsEl[i].innerText)
    }
  }
  document.getElementById("bom-cost").innerHTML = "SGD $" + bomCost.toFixed(2)

  // Get total unique number of vendors
  var bomVendorEl = document.getElementsByClassName("bom-vendor")
  var bomVendors = []
  var bomUniqVendors = []
  for (var i = 0; i < bomVendorEl.length; i++) {
    if (bomVendorEl[i].innerText) {
      bomVendors.push(bomVendorEl[i].innerText)
    }
  }
  bomUniqVendors = bomVendors.filter((v, i, a) => a.indexOf(v) === i);

  // Remove stocks interally that are already available
  ["Old Stock", "Prototype stock"].forEach(function(stock) {
    if (bomUniqVendors.indexOf(stock) > -1) {
      bomUniqVendors.splice(bomUniqVendors.indexOf(stock), 1)
    }
  })

  document.getElementById("bom-vendors").innerHTML = bomUniqVendors.length + " (" + bomUniqVendors.join(', ') + ")"
</script>
